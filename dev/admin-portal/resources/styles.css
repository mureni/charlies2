@import url("https://fonts.googleapis.com/css2?family=Fraunces:wght@500;700&family=Space+Grotesk:wght@400;500;600;700&display=swap");

:root {
   --space-scale: 0.8;
   --space-0-5: calc(0.125rem * var(--space-scale));
   --space-1: calc(0.25rem * var(--space-scale));
   --space-1-25: calc(0.3125rem * var(--space-scale));
   --space-1-5: calc(0.375rem * var(--space-scale));
   --space-2: calc(0.5rem * var(--space-scale));
   --space-2-5: calc(0.625rem * var(--space-scale));
   --space-3: calc(0.75rem * var(--space-scale));
   --space-3-5: calc(0.875rem * var(--space-scale));
   --space-4: calc(1rem * var(--space-scale));
   --space-4-5: calc(1.125rem * var(--space-scale));
   --space-5: calc(1.25rem * var(--space-scale));
   --space-5-5: calc(1.375rem * var(--space-scale));
   --space-6: calc(1.5rem * var(--space-scale));
   --space-7: calc(1.75rem * var(--space-scale));
   --space-8: calc(2rem * var(--space-scale));
   --space-9: calc(2.25rem * var(--space-scale));
   --space-10: calc(2.5rem * var(--space-scale));

   --radius-scale: .1;
   --radius-xs: calc(0.375rem * var(--radius-scale));
   --radius-s: calc(0.5rem * var(--radius-scale));
   --radius-m: calc(0.625rem * var(--radius-scale));
   --radius-l: calc(0.75rem * var(--radius-scale));
   --radius-xl: calc(0.875rem * var(--radius-scale));
   --radius-2xl: calc(1rem * var(--radius-scale));
   --radius-3xl: calc(1.125rem * var(--radius-scale));
   --radius-pill: 999rem;

   --text-2xs: 0.625rem;
   --text-xs: 0.6875rem;
   --text-s: 0.75rem;
   --text-sm: 0.8125rem;
   --text-base: 0.875rem;
   --text-md: 0.9375rem;
   --text-lg: 1rem;
   --text-xl: 1.0625rem;
   --text-2xl: 1.375rem;
   --text-3xl: 1.5rem;

   --ink: #1f1d1b;
   --ink-soft: #2d2a27;
   --ink-rgb: 31 29 27;
   --ink-55: rgb(var(--ink-rgb) / 0.55);
   --ink-60: rgb(var(--ink-rgb) / 0.6);
   --ink-65: rgb(var(--ink-rgb) / 0.65);
   --ink-70: rgb(var(--ink-rgb) / 0.7);
   --ink-75: rgb(var(--ink-rgb) / 0.75);

   --paper: #f6f0e6;
   --paper-soft: #efe2cf;
   --paper-alt: #f1e7d8;
   --paper-strong: #fffaf2;
   --paper-strong-rgb: 255 250 242;
   --paper-contrast: #ffffff;

   --nav: #14110e;
   --nav-surface: #1a1714;
   --nav-surface-strong: #0f0c0a;
   --nav-text: #f7f3ed;
   --nav-text-rgb: 247 243 237;
   --nav-glow: rgb(var(--nav-text-rgb) / 0.08);
   --nav-outline: rgb(var(--nav-text-rgb) / 0.3);
   --nav-active-ink: #1a1410;

   --accent: #c08b3a;
   --accent-strong: #9b6620;
   --accent-rgb: 192 139 58;
   --accent-strong-rgb: 155 102 32;
   --accent-20: rgb(var(--accent-rgb) / 0.2);
   --accent-92: rgb(var(--accent-rgb) / 0.92);

   --border: #e2d6c5;
   --border-soft: #e2dbd1;
   --border-muted: #f1e8dc;
   --border-strong: #d8d0c5;
   --border-warm: #e2d3c0;
   --border-warm-strong: #e6d6c5;
   --border-warm-soft: #f0e0cc;
   --border-status: #e1d1bb;
   --border-notice: #e1cbb4;
   --border-error: #e6b1a4;
   --border-success: #b9d1b0;

   --surface-panel: rgb(var(--paper-strong-rgb) / 0.92);
   --surface-elevated: var(--paper-strong);
   --surface-plain: var(--paper-contrast);
   --surface-soft: #f4eadc;
   --surface-soft-strong: #e6ddcf;
   --surface-highlight: #fff6e5;
   --surface-table: #f2e9dc;
   --surface-muted: #f7f1e7;
   --surface-note: #f2e1cf;
   --surface-tree: #fbf6ef;
   --surface-hover: #fff2dc;
   --surface-status-error: #f6d6cc;
   --surface-status-success: #dfe9d7;
   --toast-error: #8b3a2a;
   --toast-success: #3d5a2a;

   --glow-accent: rgb(var(--accent-rgb) / 0.15);
   --glow-cool: rgb(64 104 96 / 0.12);
   --glow-warm: rgb(156 85 42 / 0.14);

   --shadow-rgb: 28 20 12;
   --shadow: rgb(var(--shadow-rgb) / 0.12);
   --shadow-strong: rgb(var(--shadow-rgb) / 0.2);
   --shadow-card: rgb(var(--shadow-rgb) / 0.08);
   --shadow-nav: rgb(0 0 0 / 0.2);
   --shadow-modal: rgb(20 14 8 / 0.3);
   --shadow-hover: rgb(0 0 0 / 0.15);
   --overlay-backdrop: rgb(24 19 12 / 0.55);

   --panel-border: rgb(255 255 255 / 0.6);
   --focus-ring: rgb(var(--accent-rgb) / 0.2);
   --focus-ring-size: calc(0.1875rem * var(--space-scale));

   --bg-gradient: linear-gradient(135deg, var(--paper) 0%, var(--paper-soft) 50%, var(--paper-alt) 100%);
   --bar-gradient: linear-gradient(90deg, var(--accent), var(--accent-strong));
}

:root[data-theme="harbor"] {
   --ink: #1b232a;
   --ink-soft: #2b353e;
   --ink-rgb: 27 35 42;

   --paper: #e9f0f4;
   --paper-soft: #dbe7ee;
   --paper-alt: #e3ebf1;
   --paper-strong: #f7fbfd;
   --paper-strong-rgb: 247 251 253;
   --paper-contrast: #ffffff;

   --nav: #0f151b;
   --nav-surface: #141e25;
   --nav-surface-strong: #0c1216;
   --nav-text: #eaf4f8;
   --nav-text-rgb: 234 244 248;
   --nav-active-ink: #10222c;

   --accent: #2f7ea7;
   --accent-strong: #215e7c;
   --accent-rgb: 47 126 167;
   --accent-strong-rgb: 33 94 124;

   --border: #cad7df;
   --border-soft: #d7e2e8;
   --border-muted: #e7eff3;
   --border-strong: #bbc7cf;
   --border-warm: #ced9e0;
   --border-warm-strong: #c3cdd6;
   --border-warm-soft: #e4edf2;

   --surface-soft: #e1edf3;
   --surface-soft-strong: #d0dde6;
   --surface-table: #e4edf3;
   --surface-muted: #eef4f7;
   --surface-hover: #dfeaf1;
}

:root[data-theme="moss"] {
   --ink: #1c241c;
   --ink-soft: #2b332a;
   --ink-rgb: 28 36 28;

   --paper: #eef2e6;
   --paper-soft: #dfe7d5;
   --paper-alt: #e6eedc;
   --paper-strong: #fafcf5;
   --paper-strong-rgb: 250 252 245;
   --paper-contrast: #ffffff;

   --nav: #11160f;
   --nav-surface: #182016;
   --nav-surface-strong: #0d120b;
   --nav-text: #eef6ea;
   --nav-text-rgb: 238 246 234;
   --nav-active-ink: #1b2a19;

   --accent: #5e8f4c;
   --accent-strong: #406634;
   --accent-rgb: 94 143 76;
   --accent-strong-rgb: 64 102 52;

   --border: #cdd7c5;
   --border-soft: #d9e2d2;
   --border-muted: #e9efe4;
   --border-strong: #bec8b7;
   --border-warm: #cdd7c5;
   --border-warm-strong: #c1cab9;
   --border-warm-soft: #e6eee0;

   --surface-soft: #e4eddc;
   --surface-soft-strong: #d5dfcc;
   --surface-table: #e6efe0;
   --surface-muted: #f0f5ea;
   --surface-hover: #e1ecd9;
}

:root[data-theme="dune"] {
   --ink: #2a1e14;
   --ink-soft: #3a2b1f;
   --ink-rgb: 42 30 20;

   --paper: #f5eadb;
   --paper-soft: #ead8c4;
   --paper-alt: #f0e1d0;
   --paper-strong: #fff8ef;
   --paper-strong-rgb: 255 248 239;
   --paper-contrast: #ffffff;

   --nav: #1a120b;
   --nav-surface: #23170f;
   --nav-surface-strong: #120c07;
   --nav-text: #faefe1;
   --nav-text-rgb: 250 239 225;
   --nav-active-ink: #2a1c12;

   --accent: #c77b2a;
   --accent-strong: #9a5717;
   --accent-rgb: 199 123 42;
   --accent-strong-rgb: 154 87 23;

   --border: #e2cdb4;
   --border-soft: #ead6c1;
   --border-muted: #f2e2d2;
   --border-strong: #d6c2aa;
   --border-warm: #e0c9b1;
   --border-warm-strong: #d6bfaa;
   --border-warm-soft: #f1dfce;

   --surface-soft: #f0dfcd;
   --surface-soft-strong: #e0cfbe;
   --surface-table: #f0e0cf;
   --surface-muted: #f7efe4;
   --surface-hover: #f0ddc7;
}

* {
   box-sizing: border-box;
}

body {
   margin: 0;
   font-family: "Space Grotesk", "IBM Plex Sans", "Segoe UI", sans-serif;
   background: var(--bg-gradient);
   color: var(--ink);
   min-height: 100vh;
}

body::before {
   content: "";
   position: fixed;
   inset: 0;
   background:
      radial-gradient(circle at 10% 20%, var(--glow-accent), transparent 45%),
      radial-gradient(circle at 90% 10%, var(--glow-cool), transparent 40%),
      radial-gradient(circle at 70% 80%, var(--glow-warm), transparent 45%);
   pointer-events: none;
   z-index: 0;
}

.app {
   display: flex;
   min-height: 100vh;
   position: relative;
   z-index: 1;
}

.nav {
   width: 16.25rem;
   background: linear-gradient(180deg, var(--nav-surface) 0%, var(--nav-surface-strong) 100%);
   color: var(--nav-text);
   padding: var(--space-5) var(--space-4-5);
   display: flex;
   flex-direction: column;
   gap: var(--space-4);
   box-shadow: var(--space-3) 0 calc(1.875rem * var(--space-scale)) var(--shadow-nav);
}

.brand {
   font-family: "Fraunces", "Georgia", serif;
   font-size: var(--text-2xl);
   font-weight: 700;
   letter-spacing: 0.01875rem;
}

.nav-list {
   display: flex;
   flex-direction: column;
   gap: var(--space-2);
}

.nav-list button {
   width: 100%;
   padding: var(--space-2-5) var(--space-3);
   border: 0.0625rem solid transparent;
   border-radius: var(--radius-l);
   background: var(--nav-glow);
   color: var(--nav-text);
   text-align: left;
   cursor: pointer;
   transition: transform 0.2s ease, border-color 0.2s ease, background 0.2s ease;
}

.nav-list button:hover {   
   border-color: var(--nav-outline);
}

.nav-list button.active {
   background: var(--accent-92);
   color: var(--nav-active-ink);
   border-color: var(--accent-92);
}

.content {
   flex: 1;
   padding: var(--space-7);
}

.panel {
   background: var(--surface-panel);
   border-radius: var(--radius-3xl);
   padding: var(--space-5-5);
   box-shadow: 0 1.5rem 3.75rem var(--shadow);
   border: 0.0625rem solid var(--panel-border);
   backdrop-filter: blur(0.375rem);
   animation: panelIn 0.5s ease;
}

@keyframes panelIn {
   from {
      opacity: 0;
      transform: translateY(0.75rem);
   }
   to {
      opacity: 1;
      transform: translateY(0);
   }
}

.panel-title {
   font-family: "Fraunces", "Georgia", serif;
   font-size: var(--text-3xl);
   font-weight: 600;
   margin-bottom: var(--space-1-5);
}

.panel-subtitle {
   margin: 0 0 var(--space-4);
   color: var(--ink-70);
}

.panel-body {
   color: var(--ink-75);
}

.status {
   padding: var(--space-2-5) var(--space-3);
   border-radius: var(--radius-l);
   background: var(--paper-soft);
   border: 0.0625rem solid var(--border-status);
   margin-bottom: var(--space-3-5);
   display: none;
}

.status.visible {
   display: block;
}

.status[data-tone="error"] {
   background: var(--surface-status-error);
   border-color: var(--border-error);
}

.status[data-tone="success"] {
   background: var(--surface-status-success);
   border-color: var(--border-success);
}

.grid {
   display: grid;
   grid-template-columns: minmax(15rem, 20rem) minmax(17.5rem, 1fr);
   gap: var(--space-4-5);
   margin-bottom: var(--space-4-5);
}

.ngram-grid {
   grid-template-columns: minmax(32.5rem, 3fr) minmax(16.25rem, 1fr);
   gap: var(--space-3);
   align-items: start;
}

.lexicon-grid {
   grid-template-columns: minmax(22.5rem, 2fr) minmax(15rem, 1fr);
   gap: var(--space-3);
   align-items: start;
}

.card {
   border: 0.0625rem solid var(--border);
   border-radius: var(--radius-xl);
   padding: var(--space-4);
   background: var(--surface-elevated);
   box-shadow: 0 0.75rem 1.5rem var(--shadow-card);
}

.card h3 {
   margin: 0;
   font-size: var(--text-xl);
   font-weight: 600;
}

.ngram-card {
   padding: var(--space-3);
   border-radius: var(--radius-l);
   box-shadow: none;
}

.ngram-card .card-header {
   margin-bottom: var(--space-2);
}

.lexicon-card {
   padding: var(--space-3);
   border-radius: var(--radius-l);
   box-shadow: none;
}

.word-detail-card .detail-body {
   min-height: 7.5rem;
   gap: var(--space-2-5);
}

.word-ngram-scroll {
   max-height: 22.5rem;
   overflow: auto;
   display: flex;
   flex-direction: column;
   gap: var(--space-3);
}

.drilldown-row {
   margin-top: var(--space-1-5);
}

.list-footer {
   padding: var(--space-2) 0;
   font-size: var(--text-s);
   color: var(--ink-60);
}
.ngram-detail-card .detail-body {
   gap: var(--space-2-5);
}

.ngram-detail-card .stat-grid {
   gap: var(--space-2);
}

.ngram-detail-card .stat {
   padding: var(--space-2) var(--space-2-5);
}

.ngram-detail-card .ngram-columns {
   gap: var(--space-2);
   margin-top: var(--space-1-5);
}

.ngram-detail-card .token-list {
   gap: var(--space-1);
   margin-top: var(--space-1);
   display: flex;
   flex-wrap: wrap;
   max-height: 13.75rem;
   overflow: auto;
}

.ngram-detail-card .token-list span {
   padding: var(--space-0-5) var(--space-1-5);
   font-size: var(--text-xs);
}

.ngram-detail-card .token-chip {
   padding: var(--space-0-5) var(--space-1-5);
   font-size: var(--text-xs);
}

.card-header {
   display: flex;
   justify-content: space-between;
   align-items: center;
   gap: var(--space-3);
   margin-bottom: var(--space-3);
}

.muted {
   margin: var(--space-1) 0 0;
   color: var(--ink-65);
   font-size: var(--text-sm);
}

.list {
   max-height: 26.25rem;
   overflow: auto;
   padding-right: var(--space-1);
}

.list-item {
   width: 100%;
   padding: var(--space-2-5);
   margin-bottom: var(--space-2);
   border: 0.0625rem solid var(--border-soft);
   border-radius: var(--radius-l);
   background: var(--surface-plain);
   text-align: left;
   cursor: pointer;
   transition: border-color 0.2s ease, transform 0.2s ease;
}

.list-item:hover {
   border-color: var(--accent);
}

.list-item.active {
   border-color: var(--accent);
   background: var(--surface-highlight);
}

.list-title {
   display: flex;
   justify-content: space-between;
   align-items: center;
   font-weight: 600;
}

.list-subtitle {
   margin-top: var(--space-1);
   font-size: var(--text-s);
   color: var(--ink-60);
}

.mono {
   font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
   font-size: var(--text-s);
}

.row {
   display: flex;
   gap: var(--space-2);
   margin-bottom: var(--space-2);
}

.row-between {
   justify-content: space-between;
   align-items: center;
}

.ngram-filters {
   display: flex;
   flex-direction: column;
   gap: var(--space-2);
   margin-bottom: var(--space-2-5);
}

.filter-grid {
   display: grid;
   grid-template-columns: repeat(auto-fit, minmax(8.75rem, 1fr));
   gap: var(--space-2);
}

.field.compact {
   margin-bottom: 0;
   gap: var(--space-1);
   font-size: var(--text-s);
}

.field.compact input,
.field.compact select {
   padding: var(--space-1-25) var(--space-2);
   font-size: var(--text-s);
}

.data-table {
   border: 0.0625rem solid var(--border-soft);
   border-radius: var(--radius-m);
   overflow: hidden;
   background: var(--surface-plain);
   display: flex;
   flex-direction: column;
   overflow-x: auto;
}

.data-table-header,
.data-table-row {
   display: grid;
   grid-template-columns: 6.875rem minmax(8.75rem, 2fr) repeat(7, minmax(3rem, 1fr));
   gap: var(--space-2);
   align-items: center;
   min-width: 40rem;
}

.data-table-header {
   background: var(--surface-table);
   padding: var(--space-1-5) var(--space-2-5);
   font-size: var(--text-s);
   letter-spacing: 0.03em;
}

.table-sort {
   background: none;
   border: none;
   padding: 0;
   text-align: left;
   font: inherit;
   color: inherit;
   cursor: pointer;
}

.table-sort[data-active="true"]::after {
   content: attr(data-dir);
   margin-left: var(--space-1-5);
   font-size: var(--text-xs);
   text-transform: uppercase;
   color: var(--ink-60);
}

.data-table-body {
   position: relative;
   max-height: 22.5rem;
   overflow-y: auto;
   overflow-x: hidden;
}

.data-table-track {
   position: relative;
   width: 100%;
   height: 0;
}

.data-table-rows {
   position: absolute;
   top: 0;
   left: 0;
   right: 0;
   display: flex;
   flex-direction: column;
}

.data-table-row {
   height: 2.125rem;
   padding: 0 var(--space-2-5);
   border-bottom: 0.0625rem solid var(--border-muted);
   background: var(--surface-plain);
   text-align: left;
   cursor: pointer;
   border: none;
   width: 100%;
   font: inherit;
   color: inherit;
   font-size: var(--text-s);
}

.data-table-row span {
   overflow: hidden;
   text-overflow: ellipsis;
   white-space: nowrap;
}

.table-flag {
   font-size: var(--text-s);
   color: var(--ink-70);
}

.data-table-row:nth-child(odd) {
   background: var(--paper-strong);
}

.data-table-row:hover {
   background: var(--surface-hover);
}

.data-table-footer {
   padding: var(--space-2) var(--space-2-5);
   font-size: var(--text-s);
   color: var(--ink-60);
   border-top: 0.0625rem solid var(--border-muted);
}

.badge {
   display: inline-block;
   padding: var(--space-0-5) var(--space-2);
   border-radius: var(--radius-pill);
   background: var(--surface-soft-strong);
   font-size: var(--text-s);
}

.chip {
   display: inline-flex;
   align-items: center;
   padding: var(--space-1) var(--space-2-5);
   border-radius: var(--radius-pill);
   background: var(--accent-20);
   color: var(--accent-strong);
   font-size: var(--text-s);
   font-weight: 600;
}

.detail-body {
   display: flex;
   flex-direction: column;
   gap: var(--space-4);
}

.empty {
   color: var(--ink-60);
   font-size: var(--text-base);
}

.stat-grid {
   display: grid;
   grid-template-columns: repeat(auto-fit, minmax(7.5rem, 1fr));
   gap: var(--space-3);
}

.stat {
   background: var(--surface-soft);
   padding: var(--space-2-5) var(--space-3);
   border-radius: var(--radius-l);
   border: 0.0625rem solid var(--border-warm);
}

.stat-label {
   font-size: var(--text-xs);
   text-transform: uppercase;
   letter-spacing: 0.08em;
   color: var(--ink-60);
}

.stat-value {
   font-size: var(--text-lg);
   font-weight: 600;
   margin-top: var(--space-1-5);
}

.form-grid {
   display: grid;
   grid-template-columns: repeat(auto-fit, minmax(13.75rem, 1fr));
   gap: var(--space-3-5);
}

.form h4 {
   margin: 0 0 var(--space-2);
   font-size: var(--text-md);
}

.field {
   display: flex;
   flex-direction: column;
   gap: var(--space-1-5);
   margin-bottom: var(--space-2-5);
   font-size: var(--text-sm);
}

.meta-grid {
   display: grid;
   grid-template-columns: repeat(auto-fit, minmax(11.25rem, 1fr));
   gap: var(--space-2-5);
}

.meta-grid textarea {
   min-height: 5rem;
}

.meta-hint {
   margin: var(--space-2-5) 0;
   font-size: var(--text-s);
   color: var(--ink-65);
}

.meta-list {
   display: flex;
   flex-direction: column;
   gap: var(--space-1);
   margin-top: var(--space-1);
}

.grid.two-col {
   grid-template-columns: minmax(18rem, 1.05fr) minmax(18rem, 1fr);
}

.chat-card {
   display: flex;
   flex-direction: column;
   gap: var(--space-2-5);
   min-height: 32rem;
}

.chat-feed {
   flex: 1;
   border: 0.0625rem solid var(--border-soft);
   border-radius: var(--radius-l);
   background: var(--surface-muted);
   padding: var(--space-3);
   display: flex;
   flex-direction: column;
   gap: var(--space-2);
   overflow-y: auto;
}

.chat-row {
   display: flex;
}

.chat-bubble {
   max-width: 80%;
   padding: var(--space-2) var(--space-3);
   border-radius: var(--radius-l);
   background: var(--surface-plain);
   border: 0.0625rem solid var(--border-soft);
   box-shadow: 0 0.75rem 1.5rem var(--shadow-card);
}

.chat-bubble.user {
   margin-left: auto;
   background: var(--surface-highlight);
   border-color: var(--border-warm);
}

.chat-bubble.bot {
   margin-right: auto;
}

.chat-bubble.system {
   margin: 0 auto;
   background: var(--surface-note);
   border-color: var(--border-notice);
}

.chat-meta {
   font-size: var(--text-xs);
   text-transform: uppercase;
   letter-spacing: 0.08em;
   color: var(--ink-60);
   margin-bottom: var(--space-1);
}

.chat-text {
   font-size: var(--text-base);
   color: var(--ink);
   white-space: pre-wrap;
   word-break: break-word;
}

.chat-input {
   border-radius: var(--radius-l);
   border: 0.0625rem solid var(--border-soft);
   background: var(--surface-soft);
   padding: var(--space-3);
   display: flex;
   flex-direction: column;
   gap: var(--space-2);
}

.chat-actions {
   display: flex;
   justify-content: flex-end;
   gap: var(--space-2);
}

.code-block {
   min-height: 7.5rem;
   max-height: 16rem;
   overflow: auto;
}

.meta-row {
   display: flex;
   justify-content: space-between;
   gap: var(--space-2);
   font-size: var(--text-s);
}

.meta-key {
   text-transform: uppercase;
   letter-spacing: 0.04em;
   font-size: var(--text-2xs);
   color: var(--ink-55);
}

.meta-value {
   font-weight: 600;
   font-size: var(--text-s);
}

.graph-actions {
   margin-top: var(--space-2);
}

.graph-modal-backdrop {
   position: fixed;
   inset: 0;
   background: var(--overlay-backdrop);
   display: flex;
   align-items: center;
   justify-content: center;
   z-index: 50;
}

.graph-modal {
   width: min(60rem, 92vw);
   height: min(80vh, 45rem);
   background: var(--paper-strong);
   border-radius: var(--radius-2xl);
   border: 0.0625rem solid var(--border-warm);
   box-shadow: 0 1.25rem 2.5rem var(--shadow-modal);
   display: flex;
   flex-direction: column;
   padding: var(--space-4);
}

.graph-modal-header {
   display: flex;
   justify-content: space-between;
   align-items: center;
   gap: var(--space-3);
}

.graph-modal-body {
   margin-top: var(--space-3);
   flex: 1;
   min-height: 0;
   overflow: hidden;
}

.graph-canvas {
   --graph-gap: var(--space-3);
   --graph-column-pad: var(--space-2);
   position: relative;
   display: grid;
   grid-template-columns: minmax(13.75rem, 1fr) minmax(10rem, 13.75rem) minmax(13.75rem, 1fr);
   column-gap: var(--graph-gap);
   row-gap: var(--space-3);
   padding: var(--space-3);
   background: var(--surface-plain);
   border-radius: var(--radius-l);
   border: 0.0625rem solid var(--paper-soft);
   min-height: 0;
   height: 100%;
   overflow: hidden;
   align-items: stretch;
}

.graph-lines {
   position: absolute;
   inset: 0;
   width: 100%;
   height: 100%;
   pointer-events: none;
   z-index: 0;
}

.graph-lines path {
   stroke: var(--ink-55);
   stroke-width: 0.09375rem;
   stroke-linecap: round;
   fill: none;
}

.graph-column {
   position: relative;
   display: flex;
   flex-direction: column;
   gap: var(--space-2);
   height: 100%;
   overflow-y: auto;
   overflow-x: hidden;
   padding: var(--graph-column-pad);
   z-index: 1;
}

.graph-scroll {
   scrollbar-gutter: stable;
}

.graph-list {
   position: relative;
   display: flex;
   flex-direction: column;
   gap: var(--space-2);
   min-height: 100%;
}

.graph-column.is-empty {
   align-items: center;
   justify-content: flex-start;
}

.graph-column.is-empty .graph-list {
   min-height: 0;
}

.graph-column[data-side="prev"] .graph-list {
   align-items: flex-end;
}

.graph-column[data-side="next"] .graph-list {
   align-items: flex-start;
}

.graph-center {
   display: flex;
   align-items: center;
   justify-content: center;
   position: relative;
   height: 100%;
   z-index: 2;
}

.graph-node {
   background: var(--surface-soft);
   border: 0.0625rem solid var(--border-warm);
   border-radius: var(--radius-l);
   padding: var(--space-2) var(--space-2-5);
   font-size: var(--text-s);
   font-weight: 600;
   text-align: center;
   position: relative;
   z-index: 2;
   max-width: 15rem;
   word-break: break-word;
}

.graph-token {
   display: inline-flex;
   align-items: center;
   gap: var(--space-1);
   border: none;
   background: var(--paper-soft);
   border-radius: var(--radius-m);
   padding: var(--space-1) var(--space-1-5);
   font-size: var(--text-xs);
   cursor: pointer;
   text-align: left;
   font: inherit;
   color: inherit;
   position: relative;
}

.graph-text {
   white-space: nowrap;
}

.graph-count {
   font-size: var(--text-2xs);
   color: var(--ink-70);
   background: var(--surface-soft-strong);
   border-radius: var(--radius-pill);
   padding: 0 var(--space-1);
}

.graph-column[data-side="prev"] .graph-token {
   align-self: flex-end;
}

.graph-column[data-side="next"] .graph-token {
   align-self: flex-start;
}

.graph-token:hover {
   background: var(--border-warm);
}

input, textarea, select {
   width: 100%;
   padding: var(--space-2) var(--space-2-5);
   border-radius: var(--radius-m);
   border: 0.0625rem solid var(--border-strong);
   font-family: inherit;
   font-size: var(--text-base);
   background: var(--surface-plain);
   transition: border-color 0.2s ease, box-shadow 0.2s ease;
}

input:focus, textarea:focus, select:focus {
   outline: none;
   border-color: var(--accent);
   box-shadow: 0 0 0 var(--focus-ring-size) var(--focus-ring);
}

textarea {
   min-height: 7.5rem;
   resize: vertical;
}

.actions {
   display: flex;
   justify-content: flex-end;
   margin-top: var(--space-2-5);
}

.button {
   padding: var(--space-2) var(--space-3-5);
   border-radius: var(--radius-m);
   border: none;
   background: var(--ink);
   color: var(--nav-text);
   cursor: pointer;
   font-weight: 600;
   transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.button:hover {
   box-shadow: 0 0.5rem 1.125rem var(--shadow-hover);
}

.button.ghost {
   background: transparent;
   border: 0.0625rem solid var(--border-strong);
   color: var(--ink);
}

.button.small {
   padding: var(--space-1-5) var(--space-2-5);
   font-size: var(--text-s);
}

.button.ghost:hover {
   box-shadow: none;
}

details {
   border: 0.0625rem solid var(--border-warm);
   border-radius: var(--radius-l);
   padding: var(--space-2-5) var(--space-3);
   background: var(--paper-strong);
}

details summary {
   cursor: pointer;
   font-weight: 600;
}

details.new-category {
   margin: var(--space-2-5) 0 var(--space-3-5);
   background: var(--surface-muted);
}

pre {
   background: var(--surface-muted);
   padding: var(--space-2-5);
   border-radius: var(--radius-m);
   overflow: auto;
   font-size: var(--text-s);
   margin: var(--space-2-5) 0 0;
}

code {
   font-family: "SFMono-Regular", "Menlo", "Consolas", monospace;
   background: var(--border-muted);
   padding: var(--space-0-5) var(--space-1-5);
   border-radius: var(--radius-xs);
}

.hint-grid {
   display: grid;
   grid-template-columns: repeat(auto-fit, minmax(12.5rem, 1fr));
   gap: var(--space-2);
   margin-top: var(--space-2);
   font-size: var(--text-sm);
}

.hint-example {
   margin-top: var(--space-2-5);
   font-size: var(--text-sm);
}

.notice {
   background: var(--surface-note);
   border: 0.0625rem solid var(--border-notice);
   border-radius: var(--radius-l);
   padding: var(--space-2-5) var(--space-3);
   margin-bottom: var(--space-4);
   font-size: var(--text-sm);
}

.tree-section {
   border: 0.0625rem solid var(--border);
   border-radius: var(--radius-xl);
   padding: var(--space-3-5);
   margin-bottom: var(--space-4);
   background: var(--paper-strong);
}

details.tree-section > summary {
   display: flex;
   justify-content: space-between;
   align-items: center;
   cursor: pointer;
   list-style: none;
   font-weight: 600;
}

details.tree-section > summary::-webkit-details-marker {
   display: none;
}

details.tree-section[open] > summary {
   margin-bottom: var(--space-3);
}

.summary-title {
   font-size: var(--text-lg);
}

.tree-body {
   display: flex;
   flex-direction: column;
   gap: var(--space-3);
}

.tree-list {
   display: flex;
   flex-direction: column;
   gap: var(--space-2-5);
}

.tree-node {
   border: 0.0625rem solid var(--border-warm-strong);
   border-radius: var(--radius-l);
   padding: var(--space-2-5);
   background: var(--surface-plain);
}

.tree-node-new {
   background: var(--surface-muted);
}

.node-row {
   display: flex;
   align-items: center;
   justify-content: space-between;
   gap: var(--space-3);
   margin-bottom: var(--space-2);
}

.node-title {
   font-weight: 600;
   font-size: var(--text-base);
   flex: 1;
   word-break: break-word;
}

.node-actions {
   display: flex;
   gap: var(--space-1-5);
   flex-wrap: wrap;
}

.node-children {
   display: flex;
   flex-direction: column;
   gap: var(--space-2);
   padding-left: var(--space-3);
   border-left: 0.125rem solid var(--paper-soft);
}

.node-add {
   display: grid;
   grid-template-columns: repeat(auto-fit, minmax(8.75rem, 1fr));
   gap: var(--space-2);
   align-items: center;
}

.node-add.compact {
   grid-template-columns: 1fr auto;
}

.tree-leaf {
   display: flex;
   justify-content: space-between;
   align-items: flex-start;
   gap: var(--space-3);
   background: var(--surface-tree);
   border-radius: var(--radius-m);
   padding: var(--space-2) var(--space-2-5);
   border: 0.0625rem solid var(--border-warm-soft);
}

.brain-ngram-list {
   display: flex;
   flex-direction: column;
   gap: var(--space-2-5);
}

.brain-ngram {
   border: 0.0625rem solid var(--border-warm);
   border-radius: var(--radius-l);
   padding: var(--space-2) var(--space-3);
   background: var(--paper-strong);
}

.brain-ngram summary {
   display: flex;
   justify-content: space-between;
   gap: var(--space-3);
   cursor: pointer;
}

.ngram-meta {
   margin-top: var(--space-1-5);
   font-size: var(--text-s);
   color: var(--ink-60);
}

.ngram-columns {
   display: grid;
   grid-template-columns: repeat(auto-fit, minmax(11.25rem, 1fr));
   gap: var(--space-2-5);
   margin-top: var(--space-2);
}

.token-list {
   display: flex;
   flex-wrap: wrap;
   gap: var(--space-1-5);
   margin-top: var(--space-1-5);
}

.token-list span {
   background: var(--border-muted);
   border-radius: var(--radius-pill);
   padding: var(--space-0-5) var(--space-2);
   font-size: var(--text-s);
}

.token-preview {
   display: block;
   width: 100%;
   border: none;
   background: transparent;
   padding: 0;
   font: inherit;
   color: inherit;
   text-align: left;
   cursor: pointer;
   white-space: nowrap;
   overflow: hidden;
   text-overflow: ellipsis;
}

.token-chip {
   border: none;
   background: var(--paper-soft);
   border-radius: var(--radius-pill);
   padding: var(--space-0-5) var(--space-2);
   font-size: var(--text-s);
   cursor: pointer;
   font: inherit;
   color: inherit;
   max-width: 100%;
   overflow: hidden;
   white-space: nowrap;
   text-overflow: ellipsis;
}

.token-chip:hover {
   background: var(--border-warm);
}

.token-empty {
   font-size: var(--text-s);
   color: var(--ink-60);
}

.token-popover {
   position: fixed;
   max-width: min(34rem, 70vw);
   max-height: 40vh;
   overflow: auto;
   background: var(--surface-panel);
   border: 0.0625rem solid var(--border-strong);
   border-radius: var(--radius-l);
   padding: var(--space-3);
   box-shadow: 0 1.25rem 2.5rem var(--shadow-modal);
   z-index: 120;
}

.token-popover-meta {
   font-size: var(--text-s);
   color: var(--ink-60);
   margin-bottom: var(--space-1-5);
}

.token-popover-text {
   font-size: var(--text-base);
   color: var(--ink);
   white-space: pre-wrap;
   word-break: break-word;
}

.brain-drilldown {
   margin-top: var(--space-3);
}

.bar-list {
   display: flex;
   flex-direction: column;
   gap: var(--space-2);
}

.bar-row {
   display: grid;
   grid-template-columns: minmax(7.5rem, 1fr) minmax(7.5rem, 2fr) auto;
   gap: var(--space-2-5);
   align-items: center;
}

.bar-label {
   font-size: var(--text-sm);
   font-weight: 600;
   word-break: break-word;
}

.bar-track {
   position: relative;
   height: 0.5rem;
   background: var(--paper-soft);
   border-radius: var(--radius-pill);
   overflow: hidden;
}

.bar-fill {
   position: absolute;
   inset: 0;
   width: 0;
   background: var(--bar-gradient);
}

.bar-count {
   font-size: var(--text-s);
   color: var(--ink-60);
}

.inline-editor {
   margin-top: var(--space-2);
   display: flex;
   flex-direction: column;
   gap: var(--space-2);
}

.node-add.pattern-add {
   grid-template-columns: 1fr auto;
}

.toast {
   position: fixed;
   right: var(--space-6);
   bottom: var(--space-6);
   background: var(--ink);
   color: var(--nav-text);
   padding: var(--space-3) var(--space-4);
   border-radius: var(--radius-l);
   opacity: 0;
   transform: translateY(var(--space-2-5));
   transition: opacity 0.2s ease, transform 0.2s ease;
   z-index: 5;
}

.toast.visible {
   opacity: 1;
   transform: translateY(0);
}

.toast[data-tone="error"] {
   background: var(--toast-error);
}

.toast[data-tone="success"] {
   background: var(--toast-success);
}

@media (max-width: 61.25rem) {
   .app {
      flex-direction: column;
   }

   .nav {
      width: 100%;
      flex-direction: row;
      align-items: center;
      overflow-x: auto;
   }

   .nav-list {
      flex-direction: row;
      flex-wrap: nowrap;
      overflow-x: auto;
   }

   .nav-list button {
      white-space: nowrap;
   }

   .content {
      padding: var(--space-5);
   }

   .grid {
      grid-template-columns: 1fr;
   }
}
